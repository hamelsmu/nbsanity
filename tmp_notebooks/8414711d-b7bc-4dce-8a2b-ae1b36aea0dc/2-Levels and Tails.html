<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Levels and Tails</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="2-Levels and Tails_files/libs/clipboard/clipboard.min.js"></script>
<script src="2-Levels and Tails_files/libs/quarto-html/quarto.js"></script>
<script src="2-Levels and Tails_files/libs/quarto-html/popper.min.js"></script>
<script src="2-Levels and Tails_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="2-Levels and Tails_files/libs/quarto-html/anchor.min.js"></script>
<link href="2-Levels and Tails_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="2-Levels and Tails_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="2-Levels and Tails_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="2-Levels and Tails_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="2-Levels and Tails_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#summary" id="toc-summary" class="nav-link active" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#lets-get-started-with-gs-quant" id="toc-lets-get-started-with-gs-quant" class="nav-link" data-scroll-target="#lets-get-started-with-gs-quant">1 - Let’s get started with gs quant</a></li>
  <li><a href="#spot-space" id="toc-spot-space" class="nav-link" data-scroll-target="#spot-space">2 - Spot Space</a></li>
  <li><a href="#forward-space" id="toc-forward-space" class="nav-link" data-scroll-target="#forward-space">3 - Forward Space</a></li>
  <li><a href="#g3-rolldown" id="toc-g3-rolldown" class="nav-link" data-scroll-target="#g3-rolldown">4 - G3 Rolldown</a></li>
  <li><a href="#disclaimer" id="toc-disclaimer" class="nav-link" data-scroll-target="#disclaimer">Disclaimer</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">
<div style="margin-top: 10px; margin-bottom: 10px;">
  <p><em>Hosted with <a href="https://nbsanity.com" target="_blank">nbsanity</a>. See source notebook <a href="https://github.com/goldmansachs/gs-quant/blob/master/gs_quant/content/made_with_gs_quant/2-Levels and Tails.ipynb" target="_blank">on GitHub</a>.</em></p>
</div>

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Levels and Tails</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="summary" class="level3">
<h3 class="anchored" data-anchor-id="summary">Summary</h3>
<p>In this note, I lay down a framework for analyzing swap rates levels both in spot and forward space, and rolldown for G3 currencies. I find that: * In USD swaps, the move over the last 3 months has been an almost parallel rally across the curve in spot space. But when we look at it in forward space, we find some nuances: * 1y2y and 1y3y rallied the most as the market started pricing a deeper cutting cycle in the next 2 years * 9y1y and 30y1y rallied more than points around them as investors use those liquid points for long duration hedges<br>
* The curve is now overall very flat, though the belly of the curve has slowly steepened over the last 6 months * For investors looking to go long rates, the current shape of the curve would favor going long the backend in forward space (e.g.&nbsp;5y5y) as that’s where there is a slightly favorable rolldown * On a comparative basis: * the EUR curve is lower and steeper (as front end rates are at the lower bound) making it slightly more attractive from a roll-down perspective (but with less room to rally); and * the GBP curve lower but flatter making it a slightly more attractive hedge for a broad duration sell-off</p>
<p>The content of this notebook is split into: * <a href="#1---Let's-get-started-with-gs-quant">1 - Let’s get started with gs quant</a> * <a href="#2---Spot-Space">2 - Spot Space</a> * <a href="#3---Forward-Space">3 - Forward Space</a> * <a href="#4---G3-Rolldown">4 - G3 Rolldown</a></p>
</section>
<section id="lets-get-started-with-gs-quant" class="level3">
<h3 class="anchored" data-anchor-id="lets-get-started-with-gs-quant">1 - Let’s get started with gs quant</h3>
<p>Start every session with authenticating with your unique client id and secret. If you don’t have a registered app, create one <a href="https://marquee.gs.com/s/developer/myapps/register">here</a>. <code>run_analytics</code> scope is required for the functionality covered in this example. Below produced using gs-quant version 0.8.99.</p>
<div id="cell-3" class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> gs_quant.session <span class="im">import</span> GsSession</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>GsSession.use(client_id<span class="op">=</span><span class="va">None</span>, client_secret<span class="op">=</span><span class="va">None</span>, scopes<span class="op">=</span>(<span class="st">'run_analytics'</span>,)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="spot-space" class="level3">
<h3 class="anchored" data-anchor-id="spot-space">2 - Spot Space</h3>
<p>Let’s start by looking at USD spot swap rates accross a range of tails and how current levels compare to 3 and 6 months ago.</p>
<div id="cell-5" class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> gs_quant.markets <span class="im">import</span> PricingContext</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> gs_quant.instrument <span class="im">import</span> IRSwap</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> gs_quant.common <span class="im">import</span> PayReceive, Currency</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> gs_quant.risk <span class="im">import</span> IRFwdRate</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> timedelta</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime <span class="im">as</span> dt</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> evaluate_with_context(instruments, measure<span class="op">=</span>IRFwdRate, location<span class="op">=</span><span class="st">'NYC'</span>, pricing_date<span class="op">=</span>dt.date.today()):</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""evaluates a measure on an iterable of instruments in a pricing context (specific data location and date)"""</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> PricingContext(market_data_location<span class="op">=</span>location, pricing_date<span class="op">=</span>pricing_date):</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        calc <span class="op">=</span> [s.calc(measure) <span class="cf">for</span> s <span class="kw">in</span> instruments]</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> [s.result() <span class="cf">for</span> s <span class="kw">in</span> calc]</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> levels_and_tails(look_back_mo, fwd_points, fixed_on<span class="op">=</span><span class="st">'Tenors'</span>, fix_yrs<span class="op">=</span><span class="dv">1</span>, ccy<span class="op">=</span>Currency.USD, p_r<span class="op">=</span>PayReceive.Receive):</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""constructs a swap array w/ varying tenors/effective dates, returns frame evaluated for given lookback periods"""</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    swaps <span class="op">=</span> [IRSwap(p_r, <span class="st">'</span><span class="sc">{}</span><span class="st">y'</span>.<span class="bu">format</span>(fix_yrs), ccy, effective_date<span class="op">=</span><span class="st">'</span><span class="sc">{}</span><span class="st">y'</span>.<span class="bu">format</span>(f)) <span class="cf">for</span> f <span class="kw">in</span> fwd_points] <span class="op">\</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> fixed_on<span class="op">==</span><span class="st">'Tenors'</span> <span class="cf">else</span> [IRSwap(p_r, <span class="st">'</span><span class="sc">{}</span><span class="st">y'</span>.<span class="bu">format</span>(f), ccy, effective_date<span class="op">=</span><span class="st">'</span><span class="sc">{}</span><span class="st">y'</span>.<span class="bu">format</span>(fix_yrs)) </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>                                    <span class="cf">for</span> f <span class="kw">in</span> fwd_points]</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame({<span class="st">'</span><span class="sc">{}</span><span class="st">m ago'</span>.<span class="bu">format</span>(m) : </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>                             evaluate_with_context(swaps, pricing_date<span class="op">=</span>dt.date.today() <span class="op">+</span> timedelta(weeks<span class="op">=-</span><span class="dv">4</span><span class="op">*</span>m)) </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>                         <span class="cf">for</span> m <span class="kw">in</span> look_back_mo})<span class="op">*</span><span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-6" class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>spot <span class="op">=</span> levels_and_tails((<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>), <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">31</span>), fixed_on<span class="op">=</span><span class="st">'Forwards'</span>, fix_yrs<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>spot.set_index([[<span class="st">'</span><span class="sc">{}</span><span class="st">y'</span>.<span class="bu">format</span>(t) <span class="cf">for</span> t <span class="kw">in</span> spot.index]], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> spot.plot(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), title<span class="op">=</span><span class="st">'Spot Rates Across USD Tails'</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>ax.<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">'Rate (%)'</span>, xlabel<span class="op">=</span><span class="st">'Underlying Swap'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As we can see in the graph, swap rates have come in vs 3m ago but are higher than 6mo for tails longer than 2y. Let’s visualize the difference for each tenor using a bar chart.</p>
<div id="cell-8" class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> (spot[<span class="st">'0m ago'</span>]<span class="op">-</span>spot[<span class="st">'3m ago'</span>]).plot(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), kind<span class="op">=</span><span class="st">'bar'</span>, title<span class="op">=</span><span class="st">'USD Spot Rates Now vs 3m Ago'</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>ax.<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">'Rate (%)'</span>, xlabel<span class="op">=</span><span class="st">'Underlying Swap'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As we can see, compared to 3 months ago, swap rates have come in by ~18bps for all tails &gt; 2y.</p>
<div id="cell-10" class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> (spot[<span class="st">'0m ago'</span>]<span class="op">-</span>spot[<span class="st">'6m ago'</span>]).plot(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), kind<span class="op">=</span><span class="st">'bar'</span>, title<span class="op">=</span><span class="st">'USD Spot Rates Now vs 6m Ago'</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>ax.<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">'Rate (%)'</span>, xlabel<span class="op">=</span><span class="st">'Underlying Swap'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>But compared to 6 months ago, swap rates are higher by ~5-10bps except at tails &lt;3y where they are lower.</p>
</section>
<section id="forward-space" class="level3">
<h3 class="anchored" data-anchor-id="forward-space">3 - Forward Space</h3>
<p>Let’s look at how spot space compared to forward 1y space (we can use the same function to look at any point).</p>
<div id="cell-13" class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>forward <span class="op">=</span> levels_and_tails((<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>), <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">31</span>), fixed_on<span class="op">=</span><span class="st">'Tenors'</span>, fix_yrs<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>forward.set_index([[<span class="st">'</span><span class="sc">{}</span><span class="st">y1y'</span>.<span class="bu">format</span>(t) <span class="cf">for</span> t <span class="kw">in</span> forward.index]], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> forward.plot(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), title<span class="op">=</span><span class="st">'Forward 1y USD Rates'</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>ax.<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">'Rate (%)'</span>, xlabel<span class="op">=</span><span class="st">'Underlying Swap'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We see a similiar comparative shift in the forward space - rates are higher vs 6m but lower vs 3m. We can also visualize where the best rolldown might be - more on this later. Let’s first look if the changes are consistent across different tails.</p>
<div id="cell-15" class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> (forward[<span class="st">'0m ago'</span>]<span class="op">-</span>forward[<span class="st">'3m ago'</span>]).plot(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), kind<span class="op">=</span><span class="st">'bar'</span>, title<span class="op">=</span><span class="st">'Forward 1y USD Rates Now vs 3m Ago'</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>ax.<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">'Rate (%)'</span>, xlabel<span class="op">=</span><span class="st">'Underlying Swap'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Unlike in the spot space, 1y forward changes are less consistent across tenors - biggest changes vs 3 months ago are 2y, 9y and 30y tails.</p>
<div id="cell-17" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> (forward[<span class="st">'0m ago'</span>]<span class="op">-</span>forward[<span class="st">'6m ago'</span>]).plot(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), kind<span class="op">=</span><span class="st">'bar'</span>, title<span class="op">=</span><span class="st">'Forward 1y USD Rates Now vs 6m Ago'</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>ax.<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">'Rate (%)'</span>, xlabel<span class="op">=</span><span class="st">'Underlying Swap'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Compared to 6 months ago, the biggest change is for 4y tails - for longer tails the change falls off almost monotonically.</p>
<p>Let’s now take a look at where rates are for a number of forward points and tails.</p>
<div id="cell-19" class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> copy <span class="im">import</span> deepcopy</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># note, if using pandas version&gt;1.0.0, please delete result_type='broadcast' and replace last line with</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># return df.apply(lambda x: evaluate_with_context(x, IRFwdRate, location), axis=1)</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> construct_swap_frame(frame, ccy<span class="op">=</span>Currency.USD, with_rolldown<span class="op">=</span><span class="va">False</span>, carry_months<span class="op">=</span><span class="dv">3</span>, location<span class="op">=</span><span class="st">'NYC'</span>, p_r<span class="op">=</span>PayReceive.Receive):</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""constructs swap frame with option to subtract carry months from effective date and evaluates with pricing context"""</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> frame.<span class="bu">apply</span>(<span class="kw">lambda</span> x: [ IRSwap(p_r, termination_date<span class="op">=</span><span class="st">'</span><span class="sc">{}</span><span class="st">m'</span>.<span class="bu">format</span>(tenor), notional_currency<span class="op">=</span>ccy, </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>                                        effective_date<span class="op">=</span><span class="st">'</span><span class="sc">{}</span><span class="st">m'</span>.<span class="bu">format</span>(x.name<span class="op">-</span>carry_months <span class="cf">if</span> with_rolldown <span class="cf">else</span> x.name)) </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">for</span> tenor <span class="kw">in</span> x.index], axis<span class="op">=</span><span class="dv">1</span>, result_type<span class="op">=</span><span class="st">'broadcast'</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df.<span class="bu">apply</span>(<span class="kw">lambda</span> x: evaluate_with_context(x, IRFwdRate, location))</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> styled_heatmap(frame, title<span class="op">=</span><span class="st">''</span>):</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""styles heatmap by adding labels and centering colors around 0"""</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> deepcopy(frame)<span class="op">*</span><span class="dv">100</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    df.columns <span class="op">=</span> [<span class="st">'</span><span class="sc">{}</span><span class="st">m'</span>.<span class="bu">format</span>(t) <span class="cf">if</span> t <span class="op">&lt;</span> <span class="dv">12</span> <span class="cf">else</span> <span class="st">'</span><span class="sc">{}</span><span class="st">y'</span>.<span class="bu">format</span>(<span class="bu">int</span>(t<span class="op">/</span><span class="dv">12</span>)) <span class="cf">for</span> t <span class="kw">in</span> df.columns]</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    df.set_index([[<span class="st">'</span><span class="sc">{}</span><span class="st">m'</span>.<span class="bu">format</span>(t) <span class="cf">if</span> t <span class="op">&lt;</span> <span class="dv">12</span> <span class="cf">else</span> <span class="st">'</span><span class="sc">{}</span><span class="st">y'</span>.<span class="bu">format</span>(<span class="bu">int</span>(t<span class="op">/</span><span class="dv">12</span>)) <span class="cf">for</span> t <span class="kw">in</span> df.index]], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    limit <span class="op">=</span> <span class="bu">max</span>(<span class="bu">abs</span>(<span class="bu">min</span>(df.<span class="bu">min</span>())), <span class="bu">abs</span>(<span class="bu">max</span>(df.<span class="bu">max</span>())))</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> sns.heatmap(df, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'.2f'</span>, cmap<span class="op">=</span><span class="st">'coolwarm_r'</span>, vmin<span class="op">=-</span>limit, vmax<span class="op">=</span>limit)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    ax.<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">'Forward Start'</span>, xlabel<span class="op">=</span><span class="st">'Tenor'</span>, title<span class="op">=</span>title)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    ax.xaxis.tick_top()</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    ax.xaxis.set_label_position(<span class="st">'top'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-20" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>swap_df <span class="op">=</span> pd.DataFrame(index<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">24</span>, <span class="dv">36</span>, <span class="dv">60</span>, <span class="dv">120</span>), columns<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">12</span>, <span class="dv">24</span>, <span class="dv">36</span>, <span class="dv">48</span>, <span class="dv">60</span>, <span class="dv">72</span>, <span class="dv">84</span>, <span class="dv">120</span>, <span class="dv">180</span>, <span class="dv">240</span>)) </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>usd_spot <span class="op">=</span> construct_swap_frame(swap_df, Currency.USD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-21" class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>styled_heatmap(usd_spot, title<span class="op">=</span><span class="st">'USD Rates Across Tenors and Forwards (%)'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Unsurprsingly, rates are lowest at the front of the curve for shorter forward starts and higher at the longer tails.</p>
</section>
<section id="g3-rolldown" class="level3">
<h3 class="anchored" data-anchor-id="g3-rolldown">4 - G3 Rolldown</h3>
<p>Let’s now look at where the best 3m rolldown opportunities might be by looking a simple roll to spot scenario - more on advanced carry scenarios in later publications.</p>
<div id="cell-24" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>usd_rd <span class="op">=</span> construct_swap_frame(swap_df, Currency.USD, with_rolldown<span class="op">=</span><span class="va">True</span>, carry_months<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>styled_heatmap((usd_spot<span class="op">-</span>usd_rd)<span class="op">*</span><span class="dv">100</span>, title<span class="op">=</span><span class="st">'USD 3m Rolldown (bps)'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As we can see, in line with the curves above, there is negative at the front of the USD curve especially for tails and forward points &lt;2y. The best positive rolldown here is at 5y starting point across shorter tenors (&lt;2y). Let’s now compare this to EUR and GBP.</p>
<div id="cell-26" class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>eur_spot <span class="op">=</span> construct_swap_frame(swap_df, Currency.EUR)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>eur_rd <span class="op">=</span> construct_swap_frame(swap_df, Currency.EUR, with_rolldown<span class="op">=</span><span class="va">True</span>, carry_months<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>styled_heatmap((eur_spot<span class="op">-</span>eur_rd)<span class="op">*</span><span class="dv">100</span>, title<span class="op">=</span><span class="st">'EUR 3m Rolldown (bps)'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The big picture for EUR is largely similar but the negative rolldown is smaller at the front of the curve and the best positive rolldown is still 5y starting but for 3y, 4y and 5y tails.</p>
<div id="cell-28" class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>gbp_spot <span class="op">=</span> construct_swap_frame(swap_df, Currency.GBP)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>gbp_rd <span class="op">=</span> construct_swap_frame(swap_df, Currency.GBP, with_rolldown<span class="op">=</span><span class="va">True</span>, carry_months<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>styled_heatmap((gbp_spot<span class="op">-</span>gbp_rd)<span class="op">*</span><span class="dv">100</span>, title<span class="op">=</span><span class="st">'GBP 3m Rolldown (bps)'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The negative rolldown for GBP is lower than for EUR but higher than for USD. The best positive rolldown is at 2y forward start for 6m and 1y tenors.</p>
</section>
<section id="disclaimer" class="level3">
<h3 class="anchored" data-anchor-id="disclaimer">Disclaimer</h3>
<p>This website may contain links to websites and the content of third parties (“Third Party Content”). We do not monitor, review or update, and do not have any control over, any Third Party Content or third party websites. We make no representation, warranty or guarantee as to the accuracy, completeness, timeliness or reliability of any Third Party Content and are not responsible for any loss or damage of any sort resulting from the use of, or for any failure of, products or services provided at or from a third party resource. If you use these links and the Third Party Content, you acknowledge that you are doing so entirely at your own risk.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>